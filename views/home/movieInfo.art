<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>电影详情</title>
    <link rel="stylesheet" href="/home/css/base.css" />
    <link rel="stylesheet" href="/home/css/movie.css" />
  </head>
  <body>
    <!-- 头部框架开始 -->
    <div class="header">
      <div class="w1100">
        <!-- 网站logo开始 -->
        <h1 class="logo fl">
          <a href="/home" class="theater">伍号 剧院</a>
        </h1>
        <!-- 网站logo结束 -->
        <!-- 网站导航开始 -->
        <ul class="navigation fr">
          <li>
            <a href="/home">首页</a>
          </li>
          {{if !userInfo}}
          <li>
            <a href="/admin">登录</a>
          </li>
          {{else}}
          <li>
            <a href="/home/userInfo">{{userInfo.username}}</a>
          </li>
          <li>
            <a href="/home/logout">退出登录</a>
          </li>
          {{/if}} 
        </ul>
        <!-- 网站导航结束 -->
      </div>
    </div>
    <!-- 头部框架结束 -->
    <!-- 文章框架开始 -->
    <div class="movie">
      <div class=" w980">
        <div class="container">
          <div class="movie-header">
            <h3 class="movie-title">
              {{movie.title}}
            </h3>
            <div class="movie-info">
              <span class="mainActor">{{movie.mainActor}}</span>
              <span>{{dateformat(movie.publishDate, "yyyy, mmmm dS, dddd, h:MM:ss TT")}}</span>
              <span>{{movie.movieType}}</span>
              <div class="price fr">￥ {{movie.price}}</div>
            </div>
          </div>
          <div class="movie-content">
            <div class="movie-imgBox fl">
              <img class="movie-img" src="{{movie.cover}}" alt="" />
            </div>
            <div class="movie-intro fl">{{@movie.content.replace(/<[^>]+>/g, '')}}</div>
          </div>
          <div class="movie-buyBox">
            <div class="movie-buy fr">购买</div>
            <span class="restSeat fr"
              >剩余座位 <span class="color">{{movie.oldSeatNum}}</span></span
            >
          </div>
          <div class="movie-comment">
           {{if userInfo}}
            <h4>评论</h4>

            <form class="comment-form" action='/home/comment' method='POST'>
              <textarea class="comment" name='content'></textarea>
              <input type='hidden' name='uid' value={{@userInfo._id}}>
              <input type='hidden' name='mid' value={{@movie._id}}>
              <div class="items">
                <input type="submit" value="提交" />
              </div>
            </form>
            {{else}}
            <div><h2>先进行登录，才可以对电影进行评论</h2></div>
           {{/if}}
            <div class="comment-list">
              <div class="mb10">
              {{each comments}}
                <div class="movie-info">
                  <span class="mainActor">{{$value.uid.username}}</span>
                  <span>{{dateformat($value.time, 'yyyy, mmmm dS, dddd,  h:MM:ss TT')}}</span>
                  <span>{{$value.uid.email}}</span>
                </div>
                <div class="comment-content">
                  {{$value.content}}
                </div>
              </div>
              {{/each}}
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- 文章框架结束 -->
    <!-- 选作框架开始 -->
    <div class='curtain'>
      <div class="chooseBox">
        <div class="chooseHeader">
          <span class="chooseTitle">选择座位</span>
          <span class='fr close'>x</span>
        </div>
        <div class="chooseSeat">
            <% for(var i = 0; i < movie.seatNum.movieSeatNum; i++){ %>
              {{if Some(seat,i)}}
              <li class="seat" data-id="{{movie._id + '-' + movie.seatNum._id + '-' + i}}"><svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#d81e06" p-id="2790"></path></svg></li>
              {{else}}
              <li class="seat" data-id="{{movie._id + '-' + movie.seatNum._id + '-' + i}}"><svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#1afa29" p-id="2790"></path></svg></li>
              {{/if}}              
            <% } %>
          </ul>
        </div>
         <div class="movie-buyBox">
         <form class="modal-content" action='/home/movieBuy?mid={{@movie._id}}' method="GET">
                <div class="modal-body">
                    <input type="hidden" name="id" id="seatId"></input>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <input type="submit" class="btn btn-primary" value="购买">
                </div>
            </form>
            
          </div>
      </div>
    
    </div>

    <!-- 选作框架结束 -->
    <script src="/admin/lib/jquery/dist/jquery.min.js"></script>
    <script src="/admin/lib/bootstrap/js/bootstrap.min.js"></script>
    <script type='text/javascript' src="/admin/js/common.js"></script>
    <script>
        $('.seat').on('click',function(){
            // 将要删除的用户id存储在隐藏域中;
            if( $(this).html()=='<svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#1afa29" p-id="2790"></path></svg>'){
              $(this).html('<svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#f4ea2a" p-id="2790"></path></svg>');
              // 获取用户id
              var id = $(this).attr('data-id');
            }
            else if($(this).html()=='<svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#f4ea2a" p-id="2790"></path></svg>'){
              $(this).html('<svg t="1591582421782" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2789" width="40" height="40"><path class="path" d="M872.18457031 877.97304687H782.16259766v15.87304688c0 26.40585938-20.18847656 47.69912109-45 47.69912109-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H332.06152344v15.87304687c0 26.40673828-20.18847656 47.7-45 47.7-24.83173828 0-45.02021484-21.39521484-45.02021485-47.7v-15.87304687H152.02021484C118.88369141 877.97304687 62 817.69414063 62 782.4921875V432.51347656c0-35.1 26.81542969-63.65478516 59.97304687-63.65478515h59.99326172c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v254.57783203h540.12304688V432.51347656c0-35.1 26.81542969-63.65478516 59.97216797-63.65478515h59.99414062c33.13564453 0 59.97216797 28.43261719 59.97216797 63.65478515v350.1c0.20478516 35.1-56.65869141 95.37890625-89.81542969 95.37890625z m-59.99414062-572.76826171c-49.70390625 0-90 42.79042969-90 95.50195312V623.43652344H301.99414062V400.68652344c0-52.71152344-40.29521484-95.50195313-89.99999999-95.50195313-10.55478516 0-20.61826172-3.57978516-30.06826172 0V177.97607422c0.04130859-52.73173828 40.33652344-95.52216797 90.08173828-95.52216797h480.12890625c49.74609375 0 90.02109375 42.79042969 90.02109375 95.50195313v127.32978515c-9.45-3.68261719-19.39042969-0.10283203-29.94521485-0.10283203z" fill="#1afa29" p-id="2790"></path></svg>')
            }
            $("#seatId").val(id);
        });
        $(".movie-buy").on("click",function(){
          $(".curtain").css("display","block");
        });
        $(".close").on("click",function(){
          $(".curtain").css("display","none");
        });
    </script>
  </body>
</html>
